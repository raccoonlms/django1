<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成绩管理</title>
    {% load static %}
    <style>
         /* 全局样式设置 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            height: 100vh;
        }

        /* 添加Logo定位样式 */
        .logo {
            position: absolute;
            bottom: 0px;
            right: 0px;
            width: 220px;
        }

        /* 工具栏样式 */
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            border-bottom: 1px solid #ccc;
        }

        .toolbar .left-section {
            display: flex;
            align-items: center;
        }

        .toolbar input[type="text"] {
            padding: 5px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .toolbar button {
            padding: 5px 10px;
            margin-left: 5px;
            border: none;
            background-image: linear-gradient(to top, #00c6fb 0%, #005bea 100%);
            color: white;
            border-radius: 3px;
            cursor: pointer;
        }

        .toolbar button:hover {
            background-color: #0056b3;
        }

        /* 按钮栏样式 */
        .button-bar {
            display: flex;
            justify-content: flex-start;
            padding: 10px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ccc;
        }

        .button-bar button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            background-image: linear-gradient(to top, #00c6fb 0%, #005bea 100%);
            color: white;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
        }

        .button-bar button:hover {
            background-color: #0056b3;
        }

        /* 主要内容区域样式 */
        .main-content {
            flex: 1;
            padding: 20px;
            box-sizing: border-box;
            background-image: linear-gradient(to top, #a8edea 0%, #fed6e3 100%);
        }

        /* 输入栏样式 */
        .input-row {
            display: flex;
            margin-bottom: 10px;
        }

        .input-row label {
            width: 100px;
            margin-right: 10px;
        }

        .input-row input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        /* 按钮组样式 */
        .buttons {
            margin-bottom: 10px;
        }

        /* 表格样式 */
        .table {
            width: 100%;
            border-collapse: collapse;
            background-image: linear-gradient(-20deg, #e9defa 0%, #fbfcdb 100%);
        }

        .table th, .table td {
            border:1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        .table th {
            background-color: #f2f2f2;
        }

        /* 分页样式 */
        .pagination {
            display: flex;
            justify-content: center;
            padding: 10px;
        }

        .pagination a, .pagination span {
            padding: 5px 10px;
            margin: 0 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-decoration: none;
            color: #007bff;
        }

        .pagination .current-page {
            background-color: #007bff;
            color: white;
        }

        .pagination a:hover {
            background-color: #0056b3;
            color: white;
        }

        .pagination .disabled {
            color: #ccc;
            pointer-events: none;
        }

        .checkbox-column {
            text-align: center;
        }

        /* 下拉框悬浮效果 */
        .input-row select:hover {
            border-color: #0056b3; /* 悬浮时改变边框颜色 */
            background-color: #f0f8ff; /* 悬浮时改变背景颜色 */
        }

        .input-row select:focus {
            border-color: #0056b3; /* 聚焦时改变边框颜色 */
            background-color: #f0f8ff; /* 聚焦时改变背景颜色 */
        }

        /* 成绩输入框和按钮样式 */
        .score-input {
            display: flex;
            align-items: center;
            gap: 8px; /* 增加输入框和按钮之间的距离 */
        }

        .score-input input[type="number"] {
            width: 80px; /* 限制输入框宽度 */
        }

    </style>
</head>
<body>

    <!-- 工具栏 -->
    <div class="toolbar">
        <div class="left-section">
            <a>管理员</a>
            <a href="{% url 'logout' %}" class="register-btn"><button>退出登录</button></a>
            <!--
            <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo">
            -->
        </div>
    </div>
<!-- 按钮栏 -->
    <div class="button-bar">
        <a href="{% url 'admin_dashboard' %}"><button>返回首页</button></a>
    </div>
<div class="main-content">
 <!-- 查询功能 -->
<form method="GET" action="{% url 'query_scores' %}">
    <label for="event_id">选择项目</label>
    <select name="event_id" required>
        <option value="">请选择项目</option>
        {% for event in events %}
            <option value="{{ event.event_id }}" {% if event.event_id == event_id %}selected{% endif %}>
                {{ event.event_name }}
            </option>
        {% endfor %}
    </select>
    <button type="submit">查询</button>
</form>

<!-- 成绩表格 -->
<table class="table">
    <thead>
        <tr>
            <th>排名</th>
            <th>项目编号</th>
            <th>项目名称</th>
            <th>学号</th>
            <th>姓名</th>
            <th>成绩</th>
        </tr>
    </thead>
    <tbody>
        {% for contestant in page_obj %}
            <tr>
                <td>
                    {% if contestant.score_set %}
                        {{ contestant.score_set.first.rank }}
                    {% else %}
                        未排名
                    {% endif %}
                </td>
                <td>{{ contestant.event.event_id }}</td>
                <td>{{ contestant.event.event_name }}</td>
                <td>{{ contestant.user.user_id }}</td>
                <td>{{ contestant.user.name }}</td>
                <td class="score-input">
    <!-- 显示当前分数 -->
    <span>{{ contestant.score_set.first.score }}</span>
    
    <!-- 表单用于更新分数 -->
    <form action="{% url 'update_score' contestant.id %}" method="POST" style="display: inline;">
        {% csrf_token %}
        <input type="number" name="score" placeholder="填写成绩" required>
        <!--input type="text" name="rank" placeholder="填写排名" required-->
        <button type="submit">保存</button>
    </form>
</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6">没有成绩数据。</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 分页 -->
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page=1&event_id={{ event_id }}">首页</a>
        <a href="?page={{ page_obj.previous_page_number }}&event_id={{ event_id }}">上一页</a>
    {% else %}
        <span class="disabled">首页</span>
        <span class="disabled">上一页</span>
    {% endif %}

    <span class="current-page">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&event_id={{ event_id }}">下一页</a>
        <a href="?page={{ page_obj.paginator.num_pages }}&event_id={{ event_id }}">末页</a>
    {% else %}
        <span class="disabled">下一页</span>
        <span class="disabled">末页</span>
    {% endif %}
</div>


</div>
</body>
</html>